<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Panel – Data Kader</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.0/axios.min.js"></script>
</head>
<body class="bg-gray-100 p-6">

<h1 class="text-2xl font-bold mb-4 text-center">Admin Panel – Data Kader</h1>

<div class="mb-4 flex gap-4 flex-wrap">
  <input type="text" id="search" placeholder="Search nama/NIK/KTA..." class="border p-2 rounded-xl flex-1">
  <select id="filterJenjang" class="border p-2 rounded-xl">
    <option value="">Filter Jenjang Pendidikan</option>
    <option value="SD">SD</option>
    <option value="SMP">SMP</option>
    <option value="SMA">SMA</option>
    <option value="D1">D1</option>
    <option value="D2">D2</option>
    <option value="D3">D3</option>
    <option value="S1">S1</option>
    <option value="S2">S2</option>
    <option value="S3">S3</option>
  </select>
</div>

<div class="overflow-x-auto">
  <table class="min-w-full bg-white rounded-xl shadow-lg overflow-hidden" id="table">
    <thead class="bg-red-700 text-white">
      <tr>
        <th class="px-4 py-2">Foto</th>
        <th class="px-4 py-2">Nama</th>
        <th class="px-4 py-2">NIK</th>
        <th class="px-4 py-2">KTA</th>
        <th class="px-4 py-2">Pendidikan Formal</th>
        <th class="px-4 py-2">Pendidikan Kader</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>
</div>

<!-- Modal Resume -->
<div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center">
  <div class="bg-white rounded-xl p-6 max-w-3xl w-full overflow-auto max-h-[90vh]">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-2xl font-bold">Resume Kader</h2>
      <button onclick="closeModal()" class="text-red-600 font-bold text-xl">&times;</button>
    </div>
    <div class="flex gap-4 mb-4">
      <img id="modalFoto" src="" class="w-36 h-48 object-cover rounded shadow-md">
      <div id="modalContent" class="flex-1"></div>
    </div>
  </div>
</div>

<script>
const endpoint = "PASTE_DOGET_ENDPOINT_APPS_SCRIPT_DISINI";
let allData = [];

function renderTable(data){
  const tbody = document.getElementById("tbody");
  tbody.innerHTML = "";
  data.forEach((d, idx)=>{
    let pendidikanFormal = d.pendidikanFormal.map(p=>`${p.nama} (${p.tahun})`).join("<br>");
    let pendidikanKader = d.pendidikanKader.map(p=>`${p.nama} (${p.tahun}) | ${p.penyelenggara}`).join("<br>");
    tbody.innerHTML += `
      <tr class="border-b cursor-pointer hover:bg-gray-100" onclick="openModal(${idx})">
        <td class="px-4 py-2"><img src="${d.fotoUrl||'https://via.placeholder.com/100x133'}" class="w-16 h-20 object-cover rounded"></td>
        <td class="px-4 py-2">${d.nama}</td>
        <td class="px-4 py-2">${d.nik}</td>
        <td class="px-4 py-2">${d.kta}</td>
        <td class="px-4 py-2">${pendidikanFormal}</td>
        <td class="px-4 py-2">${pendidikanKader}</td>
      </tr>
    `;
  });
}

async function fetchData(){
  try{
    const res = await axios.get(endpoint);
    allData = res.data;
    renderTable(allData);
  }catch(err){
    console.error(err);
    alert("Gagal ambil data.");
  }
}

function openModal(idx){
  const d = allData[idx];
  document.getElementById("modalFoto").src = d.fotoUrl||'https://via.placeholder.com/180x240';
  let html = `
    <p><strong>Nama:</strong> ${d.nama}</p>
    <p><strong>NIK:</strong> ${d.nik}</p>
    <p><strong>No KTA:</strong> ${d.kta}</p>
    <p><strong>Alamat:</strong> ${d.alamat} | RT/RW: ${d.rt}/${d.rw}</p>
    <p><strong>Kel/Kec/Kab:</strong> ${d.kelurahan}/${d.kecamatan}/${d.kabupaten}</p>
    <p><strong>HP:</strong> ${d.hp}</p>
    <p><strong>Pendidikan Formal:</strong><br>${d.pendidikanFormal.map(p=>`${p.nama} (${p.tahun}) | ${p.jurusan||''}`).join("<br>")}</p>
    <p><strong>Pendidikan Kader:</strong><br>${d.pendidikanKader.map(p=>`${p.nama} (${p.tahun}) | ${p.penyelenggara}`).join("<br>")}</p>
    <p><strong>Jabatan Partai:</strong><br>${d.jabatanPartai.map(j=>`${j.nama} | ${j.tingkatan} | ${j.periode}`).join("<br>")}</p>
    <p><strong>Organisasi:</strong><br>${d.organisasi.map(o=>`${o.nama} | ${o.jabatan} | ${o.tingkatan} | ${o.periode}`).join("<br>")}</p>
    <p><strong>Bahasa:</strong> ${d.skillBahasa.join(", ")}</p>
    <p><strong>Komputer:</strong> ${d.kemampuanKomputer}</p>
    <p><strong>Media Sosial:</strong> IG:${d.medsos.instagram||'-'} | TW:${d.medsos.twitter||'-'} | FB:${d.medsos.facebook||'-'} | TT:${d.medsos.tiktok||'-'}</p>
  `;
  document.getElementById("modalContent").innerHTML = html;
  document.getElementById("modal").classList.remove("hidden");
}

function closeModal(){
  document.getElementById("modal").classList.add("hidden");
}

// Search & filter
document.getElementById("search").addEventListener("input", e=>{
  const q = e.target.value.toLowerCase();
  const filtered = allData.filter(d=>d.nama.toLowerCase().includes(q)||d.nik.includes(q)||d.kta.includes(q));
  renderTable(filtered);
});

document.getElementById("filterJenjang").addEventListener("change", e=>{
  const jenjang = e.target.value;
  const filtered = jenjang ? allData.filter(d=>d.pendidikanFormal.some(p=>p.jenjang==jenjang)) : allData;
  renderTable(filtered);
});

fetchData();
</script>

</body>
</html>
