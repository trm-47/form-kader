<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Panel – Data Kader</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.0/axios.min.js"></script>
</head>
<body class="bg-gray-100 p-6">

<h1 class="text-2xl font-bold mb-4 text-center">Admin Panel – Data Kader</h1>

<!-- Search & Filter -->
<div class="mb-4 flex gap-4 flex-wrap">
  <input type="text" id="search" placeholder="Search nama/NIK/KTA..." class="border p-2 rounded-xl flex-1">
  <select id="filterJenjang" class="border p-2 rounded-xl">
    <option value="">Filter Jenjang Pendidikan</option>
    <option value="SD">SD</option>
    <option value="SMP">SMP</option>
    <option value="SMA">SMA</option>
    <option value="D1">D1</option>
    <option value="D2">D2</option>
    <option value="D3">D3</option>
    <option value="S1">S1</option>
    <option value="S2">S2</option>
    <option value="S3">S3</option>
  </select>
</div>

<!-- Table -->
<div class="overflow-x-auto">
  <table class="min-w-full bg-white rounded-xl shadow-lg overflow-hidden" id="table">
    <thead class="bg-red-700 text-white">
      <tr>
        <th class="px-4 py-2">Nama</th>
        <th class="px-4 py-2">NIK</th>
        <th class="px-4 py-2">KTA</th>
        <th class="px-4 py-2">Pendidikan</th>
        <th class="px-4 py-2">Jabatan Partai</th>
        <th class="px-4 py-2">Organisasi</th>
        <th class="px-4 py-2">Kompetensi</th>
        <th class="px-4 py-2">Media Sosial</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>
</div>

<!-- Popup -->
<div id="popup" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 hidden z-50">
  <div class="bg-white rounded-2xl p-6 w-80 max-w-xs text-center shadow-xl space-y-4">
    <div id="popupContent" class="text-gray-700 font-semibold"></div>
    <button onclick="tutupPopup()" class="bg-red-700 text-white px-4 py-2 rounded-xl font-semibold">Tutup</button>
  </div>
</div>

<script>
const endpoint = "PASTE_DOGET_ENDPOINT_APPS_SCRIPT_DISINI";
let allData = [];

// Popup functions
function showPopup(message){
  const popup = document.getElementById("popup");
  const content = document.getElementById("popupContent");
  content.innerHTML = message;
  popup.classList.remove("hidden");
}
function tutupPopup(){ document.getElementById("popup").classList.add("hidden"); }

// Render table
function renderTable(data) {
  const tbody = document.getElementById("tbody");
  tbody.innerHTML = "";
  data.forEach(d=>{
    // Pendidikan
    let pendidikanHtml = "";
    d.pendidikanFormal.forEach(p=>{
      let jurusan = p.jurusan ? ` | Jurusan: ${p.jurusan}` : "";
      pendidikanHtml += `${p.nama} (${p.tahun})${jurusan}<br>`;
    });
    d.pendidikanKader.forEach(p=>{
      pendidikanHtml += `${p.nama} (${p.tahun}) | ${p.penyelenggara}<br>`;
    });

    // Jabatan Partai
    let jabatanHtml = "";
    d.jabatanPartai.forEach(j=>{
      jabatanHtml += `${j.nama} | ${j.tingkatan} | ${j.periode}<br>`;
    });

    // Organisasi
    let orgHtml = "";
    d.organisasi.forEach(o=>{
      orgHtml += `${o.nama} | ${o.jabatan} | ${o.tingkatan} | ${o.periode}<br>`;
    });

    // Kompetensi
    let skillHtml = `Bahasa: ${d.skillBahasa.join(", ")} | Komputer: ${d.kemampuanKomputer}`;

    // Medsos
    let medsosHtml = `IG: ${d.medsos.instagram||"-"} | TW: ${d.medsos.twitter||"-"} | FB: ${d.medsos.facebook||"-"} | TT: ${d.medsos.tiktok||"-"}`;

    tbody.innerHTML += `<tr class="border-b">
      <td class="px-4 py-2">${d.nama}</td>
      <td class="px-4 py-2">${d.nik}</td>
      <td class="px-4 py-2">${d.kta}</td>
      <td class="px-4 py-2">${pendidikanHtml}</td>
      <td class="px-4 py-2">${jabatanHtml}</td>
      <td class="px-4 py-2">${orgHtml}</td>
      <td class="px-4 py-2">${skillHtml}</td>
      <td class="px-4 py-2">${medsosHtml}</td>
    </tr>`;
  });
}

// Fetch data
async function fetchData() {
  showPopup("Loading data, mohon tunggu...");
  try {
    const res = await axios.get(endpoint);
    allData = res.data;
    renderTable(allData);
    tutupPopup();
  } catch(err) {
    console.error(err);
    showPopup("Gagal ambil data: "+err.message);
  }
}

// Filter search & jenjang
document.getElementById("search").addEventListener("input", e=>{
  const q = e.target.value.toLowerCase();
  const filtered = allData.filter(d=>d.nama.toLowerCase().includes(q) || d.nik.includes(q) || d.kta.includes(q));
  renderTable(filtered);
});
document.getElementById("filterJenjang").addEventListener("change", e=>{
  const jenjang = e.target.value;
  const filtered = jenjang ? allData.filter(d=>{
    return d.pendidikanFormal.some(p=>p.jenjang === jenjang);
  }) : allData;
  renderTable(filtered);
});

fetchData();
</script>

</body>
</html>
