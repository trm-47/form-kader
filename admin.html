<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Panel – Data Kader</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.0/axios.min.js"></script>
</head>
<body class="bg-gray-100 p-6">

<h1 class="text-2xl font-bold mb-4 text-center">Admin Panel – Data Kader</h1>

<div class="mb-4 flex gap-4 flex-wrap">
  <input type="text" id="search" placeholder="Search Nama / NIK / KTA..." class="border p-2 rounded-xl flex-1">
  <select id="filterPendidikanFormal" class="border p-2 rounded-xl">
    <option value="">Filter Pendidikan Formal</option>
    <option value="SD">SD</option>
    <option value="SMP">SMP</option>
    <option value="SMA">SMA</option>
    <option value="D1">D1</option>
    <option value="D2">D2</option>
    <option value="D3">D3</option>
    <option value="S1">S1</option>
    <option value="S2">S2</option>
    <option value="S3">S3</option>
  </select>
  <select id="filterPendidikanKader" class="border p-2 rounded-xl">
    <option value="">Filter Pendidikan Kader</option>
  </select>
</div>

<div class="overflow-x-auto">
  <table class="min-w-full bg-white rounded-xl shadow-lg overflow-hidden" id="table">
    <thead class="bg-red-700 text-white">
      <tr>
        <th class="px-4 py-2">Nama</th>
        <th class="px-4 py-2">NIK</th>
        <th class="px-4 py-2">KTA</th>
        <th class="px-4 py-2">Pendidikan Formal</th>
        <th class="px-4 py-2">Pendidikan Kader</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>
</div>

<script>
const EXEC_URL = "https://script.google.com/macros/s/AKfycbySkvO7D2s7OpnzT4PYLZSYqxqn5WCDt86i26hsn0EXNt1A2OxGYGVsV6kW9h6ZKCBo/exec"; // manual
let allData = [];

async function fetchData(){
  try{
    const res = await axios.get(EXEC_URL);
    allData = res.data;
    renderTable(allData);

    // Populate filterPendidikanKader
    const filterKader = document.getElementById("filterPendidikanKader");
    let semuaDiklat = new Set();
    allData.forEach(d=>d.pendidikanKader.forEach(p=>semuaDiklat.add(p.nama)));
    filterKader.innerHTML = '<option value="">Filter Pendidikan Kader</option>' + 
      Array.from(semuaDiklat).map(x=>`<option value="${x}">${x}</option>`).join('');
    
  }catch(err){
    console.error(err);
    alert("Gagal ambil data.");
  }
}

function renderTable(data){
  const tbody = document.getElementById("tbody");
  tbody.innerHTML = "";
  data.forEach(d=>{
    let pf = d.pendidikanFormal.map(p=>`${p.nama} (${p.tahun}) ${p.jurusan? '| '+p.jurusan:''}`).join('<br>') || '-';
    let pk = d.pendidikanKader.map(p=>`${p.nama} (${p.tahun}) | ${p.penyelenggara}`).join('<br>') || '-';
    const tr = document.createElement("tr");
    tr.className = "border-b cursor-pointer hover:bg-gray-100";
    tr.innerHTML = `<td class="px-4 py-2">${d.nama}</td>
                    <td class="px-4 py-2">${d.nik}</td>
                    <td class="px-4 py-2">${d.kta}</td>
                    <td class="px-4 py-2">${pf}</td>
                    <td class="px-4 py-2">${pk}</td>`;
    tbody.appendChild(tr);
  });
}

// Filter
document.getElementById("search").addEventListener("input", e=>{
  const q = e.target.value.toLowerCase();
  const filtered = allData.filter(d=>d.nama.toLowerCase().includes(q)||d.nik.includes(q)||d.kta.includes(q));
  renderTable(filtered);
});

document.getElementById("filterPendidikanFormal").addEventListener("change", e=>{
  const val = e.target.value;
  const filtered = val ? allData.filter(d=>d.pendidikanFormal.some(p=>p.jenjang===val)) : allData;
  renderTable(filtered);
});

document.getElementById("filterPendidikanKader").addEventListener("change", e=>{
  const val = e.target.value;
  const filtered = val ? allData.filter(d=>d.pendidikanKader.some(p=>p.nama===val)) : allData;
  renderTable(filtered);
});

fetchData();
</script>

</body>
</html>
