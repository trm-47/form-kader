<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Step 1 â€“ Data Pribadi</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

<div class="max-w-md mx-auto p-4">
  <div class="bg-white rounded-2xl shadow-xl p-6 space-y-4">

    <h2 class="text-lg font-bold text-center">Data Pribadi Kader</h2>

    <!-- Nama Lengkap -->
    <div>
      <label class="text-sm text-gray-600">Nama Lengkap</label>
      <input id="nama" class="w-full mt-1 p-3 border rounded-xl" placeholder="Nama lengkap sesuai KTP">
    </div>

    <!-- NIK -->
    <div>
      <label class="text-sm text-gray-600">NIK (16 digit)</label>
      <input id="nik" class="w-full mt-1 p-3 border rounded-xl" placeholder="Nomor Induk Kependudukan" maxlength="16">
    </div>

    <!-- Nomor KTA -->
    <div>
      <label class="text-sm text-gray-600">Nomor KTA (angka)</label>
      <input id="kta" class="w-full mt-1 p-3 border rounded-xl" placeholder="Nomor KTA PDI Perjuangan">
    </div>

    <!-- Foto Selfie -->
    <div>
      <label class="text-sm text-gray-600">Foto Selfie Kader</label>
      <input type="file" accept="image/*" capture="user" id="fotoInput" class="w-full mt-1 p-2 border rounded-xl">
      <img id="previewFoto" src="" class="mt-2 w-32 h-32 rounded-xl object-cover" style="display:none;">
    </div>

    <!-- Tombol Lanjut -->
    <button onclick="lanjut()" class="w-full bg-red-700 text-white py-3 rounded-xl font-semibold">
      Lanjut
    </button>

  </div>
</div>

<script>
const data = JSON.parse(localStorage.getItem("formKader") || "{}");

// Redirect jika belum ada data
if (!data) {
  data = {};
}

// Foto preview & simpan base64
const fotoInput = document.getElementById("fotoInput");
const previewFoto = document.getElementById("previewFoto");

fotoInput.addEventListener("change", e=>{
  const file = e.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = function(evt){
      previewFoto.src = evt.target.result;
      previewFoto.style.display = "block";
      data.foto = evt.target.result; // simpan base64
    };
    reader.readAsDataURL(file);
  }
});

function lanjut() {
  const namaVal = nama.value.trim();
  const nikVal = nik.value.trim();
  const ktaVal = kta.value.trim();

  // Validasi
  if(!namaVal || !nikVal || !ktaVal){
    alert("Nama, NIK dan KTA wajib diisi");
    return;
  }
  if(!/^\d{16}$/.test(nikVal)){
    alert("NIK harus 16 digit angka");
    return;
  }
  if(!/^\d+$/.test(ktaVal)){
    alert("KTA harus berupa angka");
    return;
  }
  if(!data.foto){
    alert("Foto selfie wajib diupload");
    return;
  }

  // Simpan ke localStorage
  data.nama = namaVal;
  data.nik = nikVal;
  data.kta = ktaVal;

  localStorage.setItem("formKader", JSON.stringify(data));

  // Lanjut ke step2
  window.location.href = "step2.html";
}

// Prefill jika ada data sebelumnya
if(data.nama) nama.value = data.nama;
if(data.nik) nik.value = data.nik;
if(data.kta) kta.value = data.kta;
if(data.foto){
  previewFoto.src = data.foto;
  previewFoto.style.display = "block";
}
</script>

</body>
</html>
