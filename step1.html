<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Step 1 â€“ Data Pribadi & Foto</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

<div class="max-w-md mx-auto p-4">
  <div class="bg-white rounded-2xl shadow-xl p-6 space-y-4">
    <h2 class="text-lg font-bold text-center">Data Pribadi & Foto</h2>

    <input class="w-full p-2 border rounded" placeholder="Nama" id="nama">
    <input class="w-full p-2 border rounded" placeholder="NIK (16 angka)" id="nik">
    <input class="w-full p-2 border rounded" placeholder="No KTA" id="kta">
    <input class="w-full p-2 border rounded" placeholder="No HP" id="hp">

    <h3 class="font-semibold text-gray-700">Foto Kader</h3>
    <div class="flex flex-col gap-2">
      <input type="file" id="fotoInput" accept="image/*">
      <video id="video" class="rounded shadow-md" autoplay style="width:100%; max-height:240px;"></video>
      <button onclick="takePhoto()" class="bg-red-700 text-white py-2 rounded">ðŸ“¸ Ambil Foto dari Camera</button>
      <canvas id="canvas" class="hidden"></canvas>
      <img id="preview" class="rounded shadow-md" style="width:180px; height:240px; object-fit:cover;">
    </div>

    <div class="flex gap-3 pt-2">
      <button onclick="lanjut()" class="w-full bg-red-700 text-white py-3 rounded-xl font-semibold">Lanjut</button>
    </div>

  </div>
</div>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const preview = document.getElementById('preview');
const fotoInput = document.getElementById('fotoInput');

let fotoBase64 = "";

// Ambil camera
navigator.mediaDevices.getUserMedia({ video: true })
.then(stream => video.srcObject = stream)
.catch(err => console.error("Camera error: ", err));

function takePhoto(){
  canvas.width = 180;
  canvas.height = 240;
  canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
  fotoBase64 = canvas.toDataURL('image/png');
  preview.src = fotoBase64;
}

// Upload file
fotoInput.addEventListener('change', (e)=>{
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = function(event){
    fotoBase64 = event.target.result;
    preview.src = fotoBase64;
  }
  reader.readAsDataURL(file);
});

function lanjut(){
  if(!fotoBase64) alert("Silakan pilih atau ambil foto!");
  const data = JSON.parse(localStorage.getItem("formKader")||"{}");
  data.nama = document.getElementById('nama').value;
  data.nik = document.getElementById('nik').value;
  data.kta = document.getElementById('kta').value;
  data.hp = document.getElementById('hp').value;
  data.fotoBase64 = fotoBase64;
  localStorage.setItem("formKader", JSON.stringify(data));
  window.location.href="step2.html";
}
</script>
</body>
</html>
