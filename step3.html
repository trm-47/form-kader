<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Step 9 – Review & Kirim</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

<div class="max-w-2xl mx-auto p-4">
<div class="bg-white rounded-2xl shadow-xl p-6 space-y-6">
<h2 class="text-lg font-bold text-center">Review & Kirim</h2>

<div id="review"></div>

<div class="flex gap-3 pt-2">
  <button onclick="kirimData()" class="w-full bg-red-700 text-white py-3 rounded-xl font-semibold">✅ Kirim Data</button>
</div>

</div></div>

<script>
const data = JSON.parse(localStorage.getItem("formKader") || "{}");
if (!data.nik) window.location.href = "step1.html";

const review = document.getElementById("review");

function buatSection(title, contentHtml, stepUrl) {
  const div = document.createElement("div");
  div.className = "space-y-2 border-b pb-2";

  const h = document.createElement("div");
  h.className = "flex justify-between items-center";
  h.innerHTML = `<h3 class="font-semibold text-gray-700">${title}</h3>
                 <button onclick="window.location.href='${stepUrl}'" class="text-sm text-blue-600 hover:underline">✏️ Edit</button>`;
  div.appendChild(h);

  const content = document.createElement("div");
  content.innerHTML = contentHtml;
  div.appendChild(content);
  return div;
}

// Review Data
review.appendChild(buatSection("Data Pribadi",
`<p class="text-sm">Nama: ${data.nama || "-"}</p>
<p class="text-sm">NIK: ${data.nik || "-"}</p>
<p class="text-sm">Nomor KTA: ${data.kta || "-"}</p>`, "step1.html"));

review.appendChild(buatSection("Alamat & Kontak",
`<p class="text-sm">Alamat: ${data.alamat || "-"}</p>
<p class="text-sm">RT/RW: ${data.rt || "-"} / ${data.rw || "-"}</p>
<p class="text-sm">Kelurahan: ${data.kelurahan || "-"}</p>
<p class="text-sm">Kecamatan: ${data.kecamatan || "-"}</p>
<p class="text-sm">Kabupaten/Kota: ${data.kabupaten || "-"}</p>
<p class="text-sm">HP: ${data.hp || "-"}</p>`, "step2.html"));

function listHtml(arr, fields) {
  return (arr || []).map((it,i)=>{
    return `<p class="text-sm">${i+1}. ${fields.map(f=>`${f.label}: ${it[f.key]||"-"}`).join(" | ")}</p>`;
  }).join("");
}

review.appendChild(buatSection("Pendidikan Formal", listHtml(data.pendidikanFormal || [], [{key:"nama",label:"Nama"},{key:"tahun",label:"Tahun"},{key:"jurusan",label:"Jurusan"}]), "step3.html"));
review.appendChild(buatSection("Pendidikan Kader", listHtml(data.pendidikanKader || [], [{key:"nama",label:"Nama"},{key:"tahun",label:"Tahun"},{key:"penyelenggara",label:"Penyelenggara"}]), "step4.html"));
review.appendChild(buatSection("Riwayat Jabatan Partai", listHtml(data.jabatanPartai || [], [{key:"nama",label:"Nama Jabatan"},{key:"tingkatan",label:"Tingkatan"},{key:"periode",label:"Periode"}]), "step5.html"));
review.appendChild(buatSection("Riwayat Organisasi", listHtml(data.organisasi || [], [{key:"nama",label:"Nama"},{key:"jabatan",label:"Jabatan"},{key:"tingkatan",label:"Tingkatan"},{key:"periode",label:"Periode"}]), "step6.html"));
review.appendChild(buatSection("Kompetensi & Skill",
`<p class="text-sm">Bahasa: ${(data.skill?.bahasa || []).join(", ") || "-"}</p>
<p class="text-sm">Komputer: ${data.skill?.komputer || "-"}</p>`, "step7.html"));
review.appendChild(buatSection("Media Sosial",
`<p class="text-sm">Instagram: ${data.medsos?.instagram || "-"}</p>
<p class="text-sm">Twitter/X: ${data.medsos?.twitter || "-"}</p>
<p class="text-sm">Facebook: ${data.medsos?.facebook || "-"}</p>
<p class="text-sm">TikTok: ${data.medsos?.tiktok || "-"}</p>`, "step8.html"));

async function kirimData() {
  try {
    const res = await fetch("PASTE_ENDPOINT_APPS_SCRIPT_DISINI", {
      method: "POST",
      body: JSON.stringify(data)
    });
    const result = await res.json();
    if(result.status==="success") {
      alert("Data berhasil dikirim!");
      localStorage.removeItem("formKader");
      window.location.href="step1.html";
    } else {
      alert("Gagal kirim data: "+result.message);
    }
  } catch(err) {
    alert("Terjadi error: "+err.message);
  }
}
</script>

</body>
</html>
