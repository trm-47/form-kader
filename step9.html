<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Step 9 – Review & Kirim</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

<div class="max-w-2xl mx-auto p-4">
  <div class="bg-white rounded-2xl shadow-xl p-6 space-y-6">
    <h2 class="text-lg font-bold text-center">Review & Kirim</h2>
    <div id="review"></div>
    <div class="flex gap-3 pt-2">
      <button onclick="kirimData()" class="w-full bg-red-700 text-white py-3 rounded-xl font-semibold">
        ✅ Kirim Data
      </button>
    </div>
  </div>
</div>

<!-- Popup -->
<div id="popup" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 hidden z-50">
  <div class="bg-white rounded-2xl p-6 w-80 max-w-xs text-center shadow-xl space-y-4">
    <div id="popupContent" class="text-gray-700 font-semibold"></div>
    <button onclick="tutupPopup()" class="bg-red-700 text-white px-4 py-2 rounded-xl font-semibold">Tutup</button>
  </div>
</div>

<script>
const data = JSON.parse(localStorage.getItem("formKader") || "{}");
if (!data.nik) window.location.href = "step1.html";

const review = document.getElementById("review");

// fungsi buat section dengan tombol edit
function buatSection(title, contentHtml, stepUrl) {
  const div = document.createElement("div");
  div.className = "space-y-2 border-b pb-2";

  const h = document.createElement("div");
  h.className = "flex justify-between items-center";
  h.innerHTML = `<h3 class="font-semibold text-gray-700">${title}</h3>
                 <button onclick="window.location.href='${stepUrl}'" class="text-sm text-blue-600 hover:underline">✏️ Edit</button>`;
  div.appendChild(h);

  const content = document.createElement("div");
  content.innerHTML = contentHtml;
  div.appendChild(content);

  return div;
}

// ================= DATA REVIEW =================

// Data Pribadi
let pribadiHtml = `
<p class="text-sm text-gray-600">Nama: ${data.nama || "-"}</p>
<p class="text-sm text-gray-600">NIK: ${data.nik || "-"}</p>
<p class="text-sm text-gray-600">Nomor KTA: ${data.kta || "-"}</p>`;
review.appendChild(buatSection("Data Pribadi", pribadiHtml, "step1.html"));

// Alamat & Kontak
let alamatHtml = `
<p class="text-sm text-gray-600">Alamat: ${data.alamat || "-"}</p>
<p class="text-sm text-gray-600">RT/RW: ${data.rt || "-"} / ${data.rw || "-"}</p>
<p class="text-sm text-gray-600">Kelurahan: ${data.kelurahan || "-"}</p>
<p class="text-sm text-gray-600">Kecamatan: ${data.kecamatan || "-"}</p>
<p class="text-sm text-gray-600">Kabupaten/Kota: ${data.kabupaten || "-"}</p>
<p class="text-sm text-gray-600">HP: ${data.hp || "-"}</p>`;
review.appendChild(buatSection("Alamat & Kontak", alamatHtml, "step2.html"));

// Pendidikan Formal
let pendidikanFormalHtml = "";
(data.pendidikanFormal || []).forEach((it, idx) => {
  let jurusan = it.jurusan ? ` | Jurusan: ${it.jurusan}` : "";
  pendidikanFormalHtml += `<p class="text-sm text-gray-600">${it.nama} (${it.tahun})${jurusan}</p>`;
});
review.appendChild(buatSection("Pendidikan Formal", pendidikanFormalHtml || "-", "step3.html"));

// Pendidikan Kader
let pendidikanKaderHtml = "";
(data.pendidikanKader || []).forEach((it, idx) => {
  pendidikanKaderHtml += `<p class="text-sm text-gray-600">${it.nama} (${it.tahun}) | ${it.penyelenggara}</p>`;
});
review.appendChild(buatSection("Pendidikan Kader", pendidikanKaderHtml || "-", "step4.html"));

// Riwayat Jabatan Partai
let jabatanHtml = "";
(data.riwayatJabatan || []).forEach((it, idx) => {
  jabatanHtml += `<p class="text-sm text-gray-600">${it.nama} | ${it.tingkatan} | ${it.periode}</p>`;
});
review.appendChild(buatSection("Riwayat Jabatan Partai", jabatanHtml || "-", "step5.html"));

// Riwayat Organisasi
let orgHtml = "";
(data.organisasi || []).forEach((it, idx) => {
  orgHtml += `<p class="text-sm text-gray-600">${it.nama} | ${it.jabatan} | ${it.tingkatan} | ${it.periode}</p>`;
});
review.appendChild(buatSection("Riwayat Organisasi", orgHtml || "-", "step6.html"));

// Kompetensi & Skill
let skillHtml = `
<p class="text-sm text-gray-600">Bahasa: ${(data.skill?.bahasa || []).join(", ") || "-"}</p>
<p class="text-sm text-gray-600">Komputer: ${data.skill?.komputer || "-"}</p>`;
review.appendChild(buatSection("Kompetensi & Skill", skillHtml, "step7.html"));

// Media Sosial
let medsosHtml = `
<p class="text-sm text-gray-600">Instagram: ${data.medsos?.instagram || "-"}</p>
<p class="text-sm text-gray-600">Twitter/X: ${data.medsos?.twitter || "-"}</p>
<p class="text-sm text-gray-600">Facebook: ${data.medsos?.facebook || "-"}</p>
<p class="text-sm text-gray-600">TikTok: ${data.medsos?.tiktok || "-"}</p>`;
review.appendChild(buatSection("Media Sosial", medsosHtml, "step8.html"));

// ================= POPUP =================
function showPopup(message){
  const popup = document.getElementById("popup");
  const content = document.getElementById("popupContent");
  content.innerHTML = message;
  popup.classList.remove("hidden");
}
function tutupPopup(){ document.getElementById("popup").classList.add("hidden"); }

// ================= KIRIM DATA =================
async function kirimData() {
  showPopup("Mengirim data, mohon tunggu...");
  try {
    const res = await fetch("PASTE_ENDPOINT_APPS_SCRIPT_DISINI", {
      method: "POST",
      body: JSON.stringify(data)
    });
    const result = await res.json();
    if(result.status === "success"){
      showPopup("Data berhasil dikirim!");
      localStorage.removeItem("formKader");
      setTimeout(()=> window.location.href="terima.html", 1500);
    } else {
      showPopup("Gagal kirim data: " + result.message);
    }
  } catch(err){
    showPopup("Terjadi error: " + err.message);
  }
}
</script>

</body>
</html>
