<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Step 9 – Review & Kirim</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

<div class="max-w-3xl mx-auto p-4">
<div class="bg-white rounded-2xl shadow-xl p-6 space-y-6">

<h2 class="text-2xl font-bold text-center text-red-700">Review & Kirim Data Kader</h2>

<div id="review" class="space-y-4"></div>

<div class="flex gap-3 pt-2">
  <button onclick="kembali()" class="w-1/2 border py-3 rounded-xl font-semibold">Kembali</button>
  <button onclick="kirimData()" class="w-1/2 bg-red-700 text-white py-3 rounded-xl font-semibold">✅ Kirim Data</button>
</div>

</div></div>

<script>
const data = JSON.parse(localStorage.getItem("formKader")||"{}");
if(!data.nik) window.location.href="step1.html";

const review=document.getElementById("review");

function buatSection(title, htmlContent, stepUrl){
  const div=document.createElement("div");
  div.className="border p-4 rounded-xl space-y-2";
  div.innerHTML=`<div class="flex justify-between items-center"><h3 class="font-semibold text-gray-700">${title}</h3>
    <button onclick="window.location.href='${stepUrl}'" class="text-sm text-blue-600 hover:underline">✏️ Edit</button></div>
    <div>${htmlContent}</div>`;
  return div;
}

// Data Pribadi
let pribadiHtml=`<p>Nama: ${data.nama||"-"}</p>
<p>NIK: ${data.nik||"-"}</p>
<p>KTA: ${data.kta||"-"}</p>`;
review.appendChild(buatSection("Data Pribadi", pribadiHtml,"step1.html"));

// Alamat
let alamatHtml=`<p>Alamat: ${data.alamat||"-"}</p>
<p>RT/RW: ${data.rt||"-"}/${data.rw||"-"}</p>
<p>Kelurahan: ${data.kelurahan||"-"}</p>
<p>Kecamatan: ${data.kecamatan||"-"}</p>
<p>Kabupaten/Kota: ${data.kabupaten||"-"}</p>
<p>HP: ${data.hp||"-"}</p>`;
review.appendChild(buatSection("Alamat & Kontak",alamatHtml,"step2.html"));

// Pendidikan Formal
let pfHtml=(data.pendidikanFormal||[]).map(p=>`${p.jenjang} | ${p.nama} (${p.tahun}) ${p.jurusan? "| Jurusan: "+p.jurusan:""}`).join("<br>")||"-";
review.appendChild(buatSection("Pendidikan Formal",pfHtml,"step3.html"));

// Pendidikan Kader
let pkHtml=(data.pendidikanKader||[]).map(p=>`${p.nama} (${p.tahun}) | ${p.penyelenggara}`).join("<br>")||"-";
review.appendChild(buatSection("Pendidikan Kader",pkHtml,"step4.html"));

// Riwayat Jabatan Partai
let jabHtml=(data.jabatanPartai||[]).map(j=>`${j.nama} | ${j.tingkatan} | ${j.periode||"-"}`).join("<br>")||"-";
review.appendChild(buatSection("Riwayat Jabatan Partai",jabHtml,"step5.html"));

// Riwayat Organisasi
let orgHtml=(data.organisasi||[]).map(o=>`${o.nama} | ${o.jabatan} | ${o.tingkatan} | ${o.periode||"-"}`).join("<br>")||"-";
review.appendChild(buatSection("Riwayat Organisasi",orgHtml,"step6.html"));

// Kompetensi
let skillHtml=`Bahasa: ${(data.skill?.bahasa||[]).join(", ")||"-"}<br>Komputer: ${data.skill?.komputer||"-"}`;
review.appendChild(buatSection("Kompetensi & Skill",skillHtml,"step7.html"));

// Media Sosial
let medsosHtml=`IG: ${data.medsos?.instagram||"-"} | TW: ${data.medsos?.twitter||"-"} | FB: ${data.medsos?.facebook||"-"} | TT: ${data.medsos?.tiktok||"-"}`;
review.appendChild(buatSection("Media Sosial",medsosHtml,"step8.html"));

// Kirim
async function kirimData(){
  try{
    const res=await fetch("https://script.google.com/macros/s/AKfycbwirvQn8_xRSNaz3TTk02EDsDRx4hDyh09R7IX4x_uhUqUdU_0XsZ_DqRRSU73TbSPc/exec",{
      method:"POST",
      body:JSON.stringify(data)
    });
    const result=await res.json();
    if(result.status==="success"){
      alert("Data berhasil dikirim!");
      localStorage.removeItem("formKader");
      window.location.href="terima.html";
    }else{
      alert("Gagal kirim: "+result.message);
    }
  }catch(err){
    alert("Error: "+err.message);
  }
}

function kembali(){ window.location.href="step8.html"; }
</script>

</body>
</html>
